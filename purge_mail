def list_messages(email):
    r = requests.get(
        f"https://mailsac.com/api/addresses/{email}/messages",
        headers=MAILSAC_HEADERS,
        timeout=20,
    )
    r.raise_for_status()
    return r.json()


def delete_message(message_id):
    r = requests.delete(
        f"https://mailsac.com/api/messages/{message_id}",
        headers=MAILSAC_HEADERS,
        timeout=20,
    )

    # 204 = success
    if r.status_code not in (200, 204):
        log(f"‚ö†Ô∏è Failed to delete message {message_id}: {r.status_code}")


def purge_mailbox(email):
    log(f"üßπ Purging Mailsac inbox for {email}...")

    try:
        msgs = list_messages(email)

        for msg in msgs:
            delete_message(msg["_id"])

        log(f"‚úÖ Purged {len(msgs)} messages for {email}")

    except Exception as e:
        log(f"‚ö†Ô∏è Failed to purge inbox for {email}: {e}")
